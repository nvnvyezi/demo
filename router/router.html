<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>HashRouter</title>
</head>
<body>
  <ul>
    <li><a href="/">yellow</a></li>
    <li><a href="/black">black</a></li>
    <li><a href="/green">green</a></li>
    <button>back</button>
  </ul>
  <script>
    // class Routers {
    //   constructor () {
    //     // 存储路由
    //     this.routes = {};
    //     // 当前路由url
    //     this.currentUrl = '';
    //     this.history = [];
    //     this.currentINdex = history.length -1;
    //     this.refresh = this.refresh.bind(this);
    //     this.backOff = this.backOff.bind(this);
    //     this.isBack = false;
    //     window.addEventListener('load', this.refresh, false);
    //     window.addEventListener('hashchange', this.refresh, false);
    //   }
    //   route (path, cb) {
    //     this.routes[path] = cb || function () {};
    //     // console.log(this.routes)
    //   }
    //   refresh () {
    //     this.currentUrl = location.hash.slice(1) || '/';
    //     if (!this.isBack) {
    //       if (this.currentINdex < this.history.length - 1) {     
    //         this.history = this.history.slice(0, this.currentINdex + 1);
    //       }
    //       this.history.push(this.currentUrl);
    //       this.currentINdex++;
    //     }
    //     // console.log(this.currentUrl, this.routes)
    //     // this.history.push(this.currentUrl);
    //     console.log(this.history)
    //     // this.currentINdex++;
    //     // console.log(this.currentUrl)
    //     this.routes[this.currentUrl]();
    //     this.isBack = false;
    //   }
    //   backOff () {
    //     this.isBack = true;
    //     this.currentINdex <= 0 ? this.currentINdex = 0 : this.currentINdex = this.currentINdex - 1;
        
    //     console.log(this.currentINdex, this.history);
    //     location.hash = `#${ this.history[this.currentINdex] }`;
    //     this.routes[this.history[this.currentINdex]]();
    //   }
    // }
    // window.Router = new Routers();
    // let body = document.getElementsByTagName('body');
    // let button = document.getElementsByTagName('button')[0];
    // button.addEventListener('click', Router.backOff, false);
    // function changeColor (color) {
    //   body[0].style.backgroundColor = color;
    // }
    // Router.route('/', function () {
    //   changeColor('yellow');
    // })
    // Router.route('/black', function () {
    //   changeColor('black');
    // })
    // Router.route('/green', function (params) {
    //   changeColor('green');
    // })
    class Routers {
      constructor () {
        this.routes = {};
        this._bindPopstate();
      }

      init (path) {
        history.replaceState({path: path}, null, path);
        this.routes[path] && this.routes[path]();
      }

      route (path, cb) {
        this.routes[path] = cb || function () {};
        console.log(this.routes)
      }

      go (path) {
        console.log(path)
        history.pushState({path: path}, null, path);
        this.routes[path] && this.routes[path]();
      }

      _bindPopstate () {
        window.addEventListener('popstate', e => {
          const path = e.state && e.state.path;
          this.routes[path] && this.routes[path]();
        })
      }
    }

    window.Router = new Routers();
    Router.init(location.pathname);
    Router.route('/', function() {
      changeBgColor('yellow');
    });
    Router.route('/blue', function() {
      changeBgColor('blue');
    });
    Router.route('/green', function() {
      changeBgColor('green');
    });
    let body = document.getElementsByTagName('body')[0];
    let ul = document.getElementsByTagName('ul')[0];
    function changeBgColor (color) {
      body.style.backgroundColor = color;
    }
    ul.addEventListener('click', e => {
      if (e.target.tagName == 'A') {
        e.preventDefault();
        Router.go(e.target.getAttribute('href'));
      }
    })
  </script>
</body>
</html>